services:
  # Redis - Backend storage for Korvet
  redis:
    image: redis
    ports:
      - "6379:6379"

  # Korvet Server - Kafka-compatible streaming service
  korvet:
    image: redisfield/korvet
    ports:
      - "9092:9092"
    environment:
      KORVET_REDIS_HOST: redis
      KORVET_SERVER_ADVERTISED_HOST: korvet
    depends_on:
      - redis

  # Web Server - Serves the Pac-Man game UI and handles API requests
  web:
    image: node:18-alpine
    working_dir: /app
    volumes:
      - ./:/app
    ports:
      - "3000:3000"
    command: sh -c "npm install && npm run server"
    environment:
      KAFKA_BROKER: korvet:9092
    depends_on:
      - korvet

  # Consumer - Processes game events from Kafka
  consumer:
    image: node:18-alpine
    working_dir: /app
    volumes:
      - ./:/app
    command: sh -c "npm install && npm run consumer"
    environment:
      KAFKA_BROKER: korvet:9092
    depends_on:
      - korvet
